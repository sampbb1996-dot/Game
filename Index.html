<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goldilocks Logic Trainer</title>
<style>
body { font-family: Arial, sans-serif; background:#0b0b0b; color:#f5f5f5; text-align:center; padding:30px; }
#app { max-width:700px; margin:0 auto; }
#stats { display:flex; flex-wrap:wrap; justify-content:center; gap:16px; font-size:14px; }
#stats div { background:#1d1d1d; padding:8px 14px; border-radius:6px; }
#question-box { margin-top:40px; padding:20px; background:#181818; border-radius:10px; min-height:120px; }
#answers { margin-top:20px; }
#answers button { margin:10px; padding:15px 25px; font-size:18px; border:none; border-radius:6px; cursor:pointer; color:#fff; }
#btn-true { background:#28a745; }
#btn-false { background:#dc3545; }
#answers button:hover { opacity:0.9; }
#feedback { margin-top:20px; font-size:22px; min-height:40px; }
</style>
</head>
<body>

<div id="app">
  <h1>Goldilocks Logic Trainer</h1>

  <div id="stats">
    <div>Ability (θ): <span id="ability">0.00</span></div>
    <div>Accuracy: <span id="accuracy">--</span></div>
    <div>Speed: <span id="speed">--</span></div>
    <div>Fatigue: <span id="fatigue">0.00</span></div>
    <div>Difficulty: <span id="difficulty">--</span></div>
  </div>

  <div id="question-box">
    <h2 id="question-text"></h2>
    <div id="answers">
      <button id="btn-true">TRUE</button>
      <button id="btn-false">FALSE</button>
    </div>
  </div>

  <div id="feedback"></div>
</div>

<script>
// --------------------------------------
// PLAYER + PREDICTOR LOGIC
// --------------------------------------
let player = { theta:0, recent:[], recentSpeed:4, fatigue:0 };

class AutoPredictor {
  constructor(){ this.wS={}; this.wL={}; this.lr=0.05; }
  sig(x){ return 1/(1+Math.exp(-x)); }
  squash(x){ return 2*this.sig(x)-1; }
  dot(w,f){ let s=0; for(let k in f){s+=(w[k]||0)*f[k];} return s; }
  recAcc(p){ return p.recent.length? p.recent.reduce((a,b)=>a+b)/p.recent.length : 0.5; }
  enc(p,q){
    return {
      bias:1, theta:p.theta, acc:this.recAcc(p), speed:p.recentSpeed,
      fatigue:p.fatigue, diff:q.difficulty, premises:q.premises,
      type:(q.type==="syllogism")?1:0, inter:p.theta*q.difficulty
    };
  }
  pS(p,q){ return this.squash(this.dot(this.wS,this.enc(p,q))); }
  pL(p,q){ return this.squash(this.dot(this.wL,this.enc(p,q))); }
  score(p,q){ return this.pS(p,q)*this.pL(p,q); }
  updW(w,f,t){
    const raw=this.dot(w,f), pred=this.squash(raw), err=t-pred;
    const g=err*(2*this.sig(raw)*(1-this.sig(raw)));
    for(let k in f){ w[k]=(w[k]||0)+this.lr*g*f[k]; }
  }
  update(p,q,sT,lT){ const f=this.enc(p,q); this.updW(this.wS,f,sT); this.updW(this.wL,f,lT); }
}
let predictor = new AutoPredictor();

// --------------------------------------
// QUESTION GENERATOR
// --------------------------------------
function genSyl(d){
  const A=["A","B","C","D","E"];
  const x=A[Math.random()*5|0];
  let y=A[Math.random()*5|0]; while(y===x) y=A[Math.random()*5|0];
  let z=A[Math.random()*5|0]; while(z===x||z===y) z=A[Math.random()*5|0];

  let correct=Math.random()>0.4;
  let text = correct
    ? `${x} > ${y}. ${y} > ${z}. Therefore ${x} > ${z}.`
    : `${x} > ${y}. ${y} > ${z}. Therefore ${x} < ${z}.`;

  return { id:Math.random()+"", type:"syllogism", text, difficulty:d, premises:2 };
}

function candidates(){ return [1,2,3,4,5,6].map(genSyl); }

function pick(){
  let c=candidates(), best=null, bs=-1e9;
  for(let q of c){
    let s=predictor.score(player,q);
    if(s>bs){bs=s; best=q;}
  }
  return best;
}

// --------------------------------------
// GAME LOOP
// --------------------------------------
let q=null, start=0;

const qt=document.getElementById("question-text");
const fb=document.getElementById("feedback");
const ab=document.getElementById("ability");
const ac=document.getElementById("accuracy");
const sp=document.getElementById("speed");
const fa=document.getElementById("fatigue");
const df=document.getElementById("difficulty");

function ui(){
  const acc = player.recent.length? player.recent.reduce((a,b)=>a+b)/player.recent.length : 0.5;
  ab.textContent=player.theta.toFixed(2);
  ac.textContent=acc.toFixed(2);
  sp.textContent=player.recentSpeed.toFixed(2);
  fa.textContent=player.fatigue.toFixed(2);
  df.textContent=q? q.difficulty : "--";
}

function ask(){
  q=pick();
  qt.textContent=q.text;
  fb.textContent="";
  start=performance.now();
  ui();
}

function ans(u){
  let rt=(performance.now()-start)/1000;
  let correct = (u===q.correct);

  fb.textContent = correct?"✔️ Correct!":"❌ Incorrect";

  let oldTheta=player.theta;
  let exp=1/(1+Math.exp(-(player.theta-q.difficulty)));
  player.theta += 0.12*((correct?1:0)-exp);

  player.recent.push(correct?1:0);
  if(player.recent.length>30) player.recent.shift();
  player.recentSpeed=rt;
  player.fatigue=Math.min(1,player.fatigue+0.01);

  let shortT = correct?1:-1;
  let longT = Math.max(-1,Math.min(1,(player.theta-oldTheta)*5));

  predictor.update({theta:oldTheta,recent:player.recent,recentSpeed:player.recentSpeed,fatigue:player.fatigue}, q, shortT, longT);

  setTimeout(ask,700);
}

document.getElementById("btn-true").onclick=()=>ans(true);
document.getElementById("btn-false").onclick=()=>ans(false);

ask();
</script>

</body>
</html>
